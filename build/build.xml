<?xml version="1.0" encoding="UTF-8"?>

<project name="CodeShelfRIA" default="" basedir="..">

	<taskdef resource="pyAntTasks.properties">
		<classpath>
			<pathelement location="${basedir}/build/lib/pyAntTasks-1.3.3.jar" />
		</classpath>
	</taskdef>

	<property name="src.dir" value="src" />

	<target name="lint">
		<exec command="/usr/local/bin/gjslint">
			<arg value="-r" />
			<arg value="src/js_uncompiled" />
			<arg value="--nojsdoc" />
		</exec>
	</target>

	<target name="templates">
		<java jar="./lib/GoogleClosureTemplates/SoyToJsSrcCompiler.jar" fork="true" failonerror="true" maxmemory="128m">
			<arg value="--outputPathFormat" />
			<arg value="./src/templates/{INPUT_FILE_NAME_NO_EXT}_generated.js" />
			<arg value="./src/templates/codeshelf.soy" />
		</java>
	</target>

	<target name="deps.writer">
		<py-run script="./lib/GoogleClosureLibrary/closure/bin/build/depswriter.py" pythonpath="${basedir}" optimize="0">
			<arg value="--root_with_prefix=../lib/SlickGrid ../../../SlickGrid" />
			<arg value="--root_with_prefix=../src ../../../../src" />
			<arg value="--output_file=../src/js_uncompiled/deps.js" />
		</py-run>
	</target>

	<target name="compile">
		<py-run script="./lib/GoogleClosureLibrary/closure/bin/build/closurebuilder.py" pythonpath="${basedir}" optimize="0">
			<arg value="--path ../lib/GoogleClosureLibrary/closure/" />
			<arg value="--path ../lib/GoogleClosureLibrary/third_party/" />
			<arg value="--path ../lib/SlickGrid/" />
			<arg value="--path ../lib/GoogleClosureTemplates/soyutils_usegoog.js" />
			<arg value="--path ../src/js_uncompiled" />
			<arg value="--namespace=codeshelf" />
			<arg value="--output_mode=compiled" />
			<arg value="--compiler_jar=../lib/GoogleClosureLibrary/compiler.jar" />
			<arg value="--compiler_flags=--compilation_level=ADVANCED_OPTIMIZATIONS" />
			<arg value="--output_file=../src/js/codeshelf.js" />
		</py-run>
	</target>

</project>